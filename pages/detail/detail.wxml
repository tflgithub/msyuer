<import src="../../wxParse/wxParse.wxml" />
<import src="../../common/pageState/pageState.wxml" />
<template is="pageState" data="{{...pageState}}" />
<custom-modal hideModal="{{hideModal}}" height='658rpx' width='550rpx' left='取消' right='提交' bindcancel="modalCancel" bindconfirm='modalConfirm'>
  <view class='modal-content'>
    <image src='../../image/ic_close.png' class='modal-close' catchtap='modalCancel' />
    <text style='font-size:34rpx;color:#000;margin-top:24rpx'>打分</text>
    <block wx:for="{{stars}}" wx:key='*this'>
      <image class="star-image" style="left: {{item*80}}rpx" src="{{key > item ?(key-item == 0.5?halfSrc:selectedSrc) : normalSrc}}">
        <view class="item" style="left:0rpx" data-key="{{item+0.5}}" bindtap="selectLeft"></view>
        <view class="item" style="left:24rpx" data-key="{{item+1}}" bindtap="selectRight"></view>
      </image>
    </block>
    <view class='middle-content'>
      <text style='font-size:34rpx;color:#000;margin-bottom:20rpx'>其他想说的</text>
      <view class='labels'>
        <view wx:for='{{evaluate}}' wx:key='*this' class="{{item.checked?'label_checked':'label_normal'}}" bindtap="evaluateSelection" data-index='{{index}}'>
          {{item.text}}
        </view>
      </view>
    </view>
  </view>
</custom-modal>
<scroll-view scroll-into-view="{{toView}}" style="width:100%;height:100%;white-space:nowrap" scroll-y="true" bindscrolltolower="onReachBottom" bindscroll="scrollTopFun" enable-back-to-top='true'>
  <view class='pages' style='margin-bottom:170rpx'>
    <!-- <share-image drawDataList="{{dataList}}" hideModal="{{hideModal}}" /> -->
    <view wx:if="{{isPlaying}}">
      <video class="{{videoType}}" id="myVideo" src='{{data.detailInfo.videoUrl}}' show-center-play-btn='false' show-fullscreen-btn='false' poster="{{data.detailInfo.phoUrl}}" controls custom-cache='{{false}}'>
      </video>
    </view>
    <view wx:else>
      <image style="width:750rpx;height:463rpx;" mode="widthFit" src="{{data.detailInfo.phoUrl}}"></image>
      <block wx:if="{{isBindMobile===2}}">
        <view class="cover">
          <view class="desc">
            <view class="first">绑定手机</view>
            <view class="second">可限时免费观看视频</view>
          </view>
          <button class="btn" bindtap='bindaccount'>去绑定</button>
        </view>
      </block>
      <block wx:else>
        <view class="play_icon">
          <image src="../../image/ic_video.png" style='width:100rpx;height:100rpx;' bindtap='startPlay' />
        </view>
      </block>
    </view>

    <view wx:if="{{data.detailInfo.title}}" style='margin-left:30rpx;font-weight:bold;font-size:38rpx;'>{{data.detailInfo.title}}</view>
    <view class="{{fixedTop?'topnav':''}}">
      <view class="midlle">
        <view class='cell' style='margin-bottom:20rpx'>
          <view class='item'>
            <image src="../../image/ic_pingfen.png" style="width:28rpx;height:27rpx" class="weui-media-box__info" />
            <view class="weui-media-box__info">{{data.detailInfo.score}}</view>
          </view>
          <view class='item'>
            <image src="../../image/ic_readname.png" style="width:34rpx;height:34rpx" class="weui-media-box__info" />
            <view class="weui-media-box__info">{{data.detailInfo.clickNum}}</view>
          </view>
          <view class="item">
            <image src="../../image/ic_like.png" style="width:34rpx;height:34rpx" class="weui-media-box__info" />
            <view class="weui-media-box__info">{{likeNum}}</view>
          </view>
        </view>
        <block wx:if="{{hadLike}}">
          <image bindtap='unlike' src="../../image/ic_like_click.png" style='width:40rpx;height:40rpx;margin-right:30rpx;margin-bottom:10rpx;z-index:99;padding:30rpx;' />
        </block>
        <block wx:else>
          <image bindtap='dolike' src="../../image/ic_like_default.png" style='width:40rpx;height:40rpx;margin-right:30rpx;margin-bottom:10rpx;z-index:99;padding:30rpx;' />
        </block>
      </view>

    </view>
    <view class='line'></view>
    <view style='margin-left:30rpx;margin-top:30rpx;font-weight:bold;font-size:34rpx;'>简介</view>
    <view style='margin:20rpx 30rpx 30rpx 30rpx;color:#666666;font-size:30rpx'>
      <view class="wxParse">
        <template is="wxParse" data="{{wxParseData:article.nodes}}" />
      </view>
    </view>
    <block wx:if="{{recommendList.length>0}}">
      <view class='line'></view>
      <view style='margin-left:30rpx;margin-top:30rpx;font-weight:bold;font-size:34rpx;'>推荐</view>
    </block>
    <block wx:for="{{recommendList}}" wx:for-item="item" wx:key="{{index}}">
      <view bindtap='gotoDetail' data-id="{{item.detailId}}" class="weui-media-box weui-media-box_appmsg">
        <view class="weui-media-box__hd_in-appmsg">
          <image class="weui-media-box__thumb" src="{{item.phoUrl}}" />
        </view>
        <view class="weui-media-box__bd_in-appmsg">
          <view class="weui-media-box__desc">{{item.title}}
            <text class="time">{{item.duration}}</text>
          </view>
          <view class='cell'>
            <view class='item'>
              <image src="../../image/ic_readname.png" style="width:34rpx;height:34rpx" class="weui-media-box__info" />
              <view class="weui-media-box__info">{{item.clickNum}}</view>
            </view>
            <view class="item">
              <image src="../../image/ic_like.png" style="width:34rpx;height:34rpx" class="weui-media-box__info" />
              <view class="weui-media-box__info">{{item.likeNum}}</view>
            </view>
          </view>
        </view>
      </view>
    </block>


    <block wx:if="{{worksList.length>0}}">
      <block wx:if="{{recommendList.length===0}}">
        <view class='line' id='works'></view>
      </block>
      <view  style='margin:30rpx;font-weight:bold;font-size:34rpx;'>作品集</view>
    </block>

    <block wx:for="{{worksList}}" wx:key="*this" wx:for-index="bindex">
      <view class='vertical_layout' style='margin-left:30rpx;margin-top:30rpx'>
        <view style='display:flex;align-items:center'>
          <view style='flex:1;display:flex;align-items:center'>
            <image src='{{item.avatarUrl}}' style='width:70rpx;height:70rpx;border-radius:50%' mode='aspectFit' />
            <text style='font-size:32rpx;color:#3976bf;margin-left:20rpx'>{{item.nickName}}</text>
          </view>
          <text style='font-size:24rpx;color:#999999;margin-right:30rpx;'>{{item.workCreateTime}}</text>
        </view>
        <view style='font-size:30rpx;margin:20rpx 30rpx 15rpx 0;display:block;white-space:pre-wrap'>{{item.workContent}}</view>
        <view style='display:flex;flex-direction:row; flex-wrap:wrap'>
          <block wx:for='{{item.workUrls}}' wx:key='*this'>
            <image src='{{item}}' data-src="{{item}}" bindtap="previewImage" style='height:150rpx;width:224rpx;border-radius:8rpx;margin:5rpx;' data-bindex='{{bindex}}' />
          </block>
        </view>
        <block wx:for='{{item.replyItems}}' wx:key='*this'>
          <view class='midlle' style='margin:30rpx 30rpx 0 0;'>
            <text style='font-size:32rpx;color:#fe5151;margin-bottom:10rpx'>{{item.replyNickName}}回复：</text>
            <text style='font-size:24rpx;color:#999999;'>{{item.replyCreateTime}}</text>
          </view>
          <view style='font-size:32rpx;color:30rpx;display:block;white-space:pre-wrap;margin-right:30rpx'>{{item.replyContent}}</view>
        </block>
      </view>
    </block>
    <block wx:if="{{showLoading}}">
      <view class="weui-loadmore">
        <view class="weui-loading"></view>
        <view class="weui-loadmore__tips">正在加载</view>
      </view>
    </block>
    <block wx:if="{{showNoMore}}">
      <view class="weui-loadmore weui-loadmore_line">
        <view class="weui-loadmore__tips weui-loadmore__tips_in-line">已经到底线啦~</view>
      </view>
    </block>
  </view>
</scroll-view>
<view class="bottom-float">
  <view class='pf__image' catchtap='rating'>
    <image src='../../image/ic_pf.png' style='width:46rpx;height:43rpx;margin-bottom: 10rpx;vertical-align:middle' />
  </view>
  <view class='zp__image' catchtap='uploadWorks'>
    <image src='../../image/ic_czp.png' style='width:47rpx;height:42rpx;vertical-align:middle;margin-bottom: 10rpx;' />
  </view>
  <button open-type="share" plain='true' style='border:none;'>
    <image src='../../image/ic_share.png' style='width:40rpx;height:40rpx;vertical-align:middle;margin-bottom: 10rpx;' />
  </button>
</view>